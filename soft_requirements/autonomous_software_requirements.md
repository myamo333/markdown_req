# 自動運転ソフトウェア要件（ADS-L2）

## 1. 概要

本書はレベル2自動運転支援システムにおけるコアソフトウェア要件を定義する。対象ソフトウェアは以下の3層で構成される。

1. **知覚層**：センサフュージョンとオブジェクトトラッキングを担当
2. **計画層**：経路計画、車線変更計画、フォールバック戦略を担当
3. **制御層**：縦・横制御アルゴリズムを実行し、VCUへコマンドを送信

## 2. 知覚ソフトウェア要件

- [SWP-001]
  カメラ・レーダ・LiDARの検出結果を50ms以内にフュージョンし、世界座標系で統一されたオブジェクトリストを出力すること。
- [SWP-002]
  オブジェクトトラッカーは最大128ターゲットを支持し、ロスト後1秒以内に再捕捉した場合は同一IDを再利用すること。
- [SWP-003]
  セマンティックセグメンテーションの信頼度が0.6未満になった場合、計画層へ信頼度低下フラグを通知すること。

## 3. 計画ソフトウェア要件

### 経路計画

- [SWP-101]
  ローカル経路計画器は2秒先までのスプライン経路を100ms周期で再生成し、速度計画と一貫性を保つこと。
- [SWP-102]
  追従シナリオでは可変時間ギャップ制御を適用し、ギャップ指令は0.8～2.0秒の範囲に制限すること。

### フォールバック

- [SWP-110]
  異常検知時にフェイルセーフ経路を生成し、減速度2.0m/s²で路肩停止する軌跡を出力すること。
- [SWP-111]
  計画層が安全経路を生成できない場合、フォールバック結果コードをHMIへ転送し、ドライバへ即時通知すること。

## 4. 制御ソフトウェア要件

| ID      | 要件内容                                                              | 応答時間 |
| ------- | --------------------------------------------------------------------- | -------- |
| SWC-201 | 縦制御を20ms周期で実行し、コマンドと実績誤差が5%超なら補正する        | 20ms     |
| SWC-202 | 横制御はStanley法を基礎とし、カーブ半径150m未満では舵角制限を強化する | 20ms     |
| SWC-203 | VCU応答遅延を50ms以内に推定し、フィードフォワード項に反映すること     | 50ms     |

## 5. ソフトウェア診断・モニタリング

- [SWM-301]
  各ソフトウェアタスクはヘルスチェックハートビートを100ms周期でSDU監視機構へ送信する。
- [SWM-302]
  計画層と制御層のCPU使用率が80%を超過した場合、ログにメトリクスを記録し、スロットリングを実行する。
- [SWM-303]
  ソフトウェア異常コードはAUTOSAR準拠の診断サービスIDにマッピングすること。

## 6. テストと検証

| テストカテゴリ | 内容                                           | 成功条件                                 |
| -------------- | ---------------------------------------------- | ---------------------------------------- |
| ユニットテスト | 知覚・計画・制御各モジュールのユニット実行     | カバレッジ80%以上、重要関数100%          |
| SIL            | 天候・交通条件を変えたシナリオシミュレーション | 1,000ケース連続稼働で失敗0件             |
| HIL            | 実ECUと動的ベンチで計画～制御ループを検証      | 制御遅延が要求値以内でフォールバック成功 |

## 7. 変更履歴

| バージョン | 日付       | 変更概要                 |
| ---------- | ---------- | ------------------------ |
| 0.1.0      | 2025-03-20 | 初版（ダミーコンテンツ） |
